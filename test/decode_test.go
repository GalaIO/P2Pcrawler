package test

import (
	"encoding/hex"
	"fmt"
	"github.com/GalaIO/P2Pcrawler/dht"
	"log"
	"testing"
)

func TestDecode(t *testing.T) {
	//raw := "64313a7264323a696432303a3c00727348b3b8ed70baa1e1411b3869d8481321353a6e6f6465733230383ae362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d5e362cc8bc798e9b616348dd482139ac5f5a24c838e04d163c8d565313a74323a6161313a76343a4a420000313a79313a7265"
	raw := "64313a7264323a696432303ae362cc8bc798e9b616348dd482139ac5f5a24c83353a6e6f6465733230383a663978af8cc93057aa391db6c02e28920846507505bdb939c8ea66da681d446a55f0c05b972c4464feb2c006165118157d53e120254ecff1f1bbe9ebb3a6db3c870c3e99245e0d90c000945c896521fe13a6a764cfe9057c2bf872baabf97602fcdbd5884fee82c236b0eee0f42a2abba9a3af85282372e10124858905bdbb5ac9290c0edce5a05d0b3d275b9557f3e66ca9b7b00c126d7b29c16bf70f20e449f1f1bbe9ebb3a6db3c870c3e99245e52640b1fd553d7075c3174989b29a592f287cc5095033fded997052d0ae6a71ae165313a74323a6161313a79313a7265"

	bytes, err := hex.DecodeString(raw)
	if err != nil {
		log.Fatal(err)
	}

	dicts, err := dht.DecodeDict(string(bytes))
	if err != nil {
		log.Fatal(err)
	}

	body := dicts.GetDict("r")
	fmt.Println("id", hex.EncodeToString([]byte(body.GetString("id"))))
	fmt.Println("nodes", hex.EncodeToString([]byte(body.GetString("nodes"))))
}
